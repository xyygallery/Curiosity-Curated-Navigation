<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Generator</title>

<style>
body {
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #fff;
  font-family: system-ui, -apple-system;
  color: #111;
}

.app {
  text-align: center;
  width: 600px;
}

.step {
  display: none;
  margin: 20px 0;
}

.step.active {
  display: block;
}

input {
  width: 500px;
  font-size: 28px;
  padding: 12px 6px;
  border: none;
  outline: none;
  background: transparent;
  pointer-events: none; /* 不可直接点击输入 */
  text-align: center;
}

input::placeholder {
  color: #aaa;
}

.all {
  margin-top: 60px;
  text-align: left;
}

pre {
  font-size: 16px;
  line-height: 1.6;
  white-space: pre-wrap;
}

/* 隐藏的全局接收 textarea */
#globalInput {
  position: absolute;
  left: -9999px;
  width: 1px;
  height: 1px;
  opacity: 0;
}
</style>
</head>

<body>

<div class="app">

  <div class="step active"><input id="url" placeholder="https://example.com"></div>
  <div class="step"><input id="title" placeholder="标题"></div>
  <div class="step"><input id="desc" placeholder="描述"></div>
  <div class="step"><input id="date" placeholder="YYYY-MM-DD"></div>

  <div class="all">
    <pre id="allOutput"></pre>
  </div>

  <!-- 隐藏 textarea 用于捕获中文输入 -->
  <textarea id="globalInput" autofocus></textarea>

</div>

<script>
let step = 0;
const steps = document.querySelectorAll('.step');
const fields = ['url','title','desc','date'];
let allCodes = [];

// buffer 用于显示当前输入内容
let buffer = '';

function render() {
  steps.forEach((s,i)=>s.classList.toggle('active', i===step));
  document.getElementById(fields[step]).value = buffer;
}

// 初始化日期
function today() {
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}

// 格式化日期
function formatDate(s){
  const [y,m,d]=s.split("-");
  return `${parseInt(y)}/${parseInt(m)}/${parseInt(d)}`;
}

// 生成代码
function generate(forceDate=false) {
  const urlVal = document.getElementById('url').value;
  const titleVal = document.getElementById('title').value;
  const descVal = document.getElementById('desc').value;
  const dateVal = forceDate ? today() : document.getElementById('date').value || today();

  if (!urlVal || !titleVal || !descVal) return;

  const code = `
<a href="${urlVal}" target="_blank" title="收录日期：${dateVal}">
  <h2>${titleVal} -></h2>
  <p>${descVal}</p>
</a>`.trim();

  allCodes.push(code);
  allOutput.textContent = allCodes.join("\n\n");

  // 清空 buffer 和 input
  fields.forEach(id => document.getElementById(id).value = '');
  buffer = '';
  step = 0;
  render();
}

// 全局 input 监听
const globalInput = document.getElementById('globalInput');
globalInput.focus();

globalInput.addEventListener('input', e => {
  buffer = globalInput.value;
  render();
});

// 全局按键
document.addEventListener('keydown', e => {

  // Ctrl + C 复制全部
  if (e.ctrlKey && e.key.toLowerCase() === 'c') {
    if (allCodes.length) navigator.clipboard.writeText(allCodes.join("\n\n"));
    return;
  }

  // Ctrl + Enter 强制生成
  if (e.ctrlKey && e.key === 'Enter') {
    generate(true);
    return;
  }

  // Enter 下一步 / 生成
  if (e.key === 'Enter') {
    if (step === 0 && !/^https?:\/\//.test(buffer)) return;
    if (step < 3) {
      document.getElementById(fields[step]).value = buffer;
      buffer = '';
      globalInput.value = '';
      step++;
      render();
    } else {
      document.getElementById(fields[step]).value = buffer;
      generate();
      globalInput.value = '';
    }
    return;
  }

  // Backspace 删除
  if (e.key === 'Backspace') {
    buffer = buffer.slice(0,-1);
    render();
    return;
  }
});

// 保持 globalInput 焦点
setInterval(()=>globalInput.focus(), 100);
render();
</script>

</body>
</html>
