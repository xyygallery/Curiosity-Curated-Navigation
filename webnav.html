<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>XXOO · 网址导航</title>
  <meta name="color-scheme" content="light dark">
  <style>
    /* ===== 设计系统 / 视觉还原：轻拟物卡片 + 背景纹理 + 右侧边栏 ===== */
    :root{
      --bg: #f6f7fb;
      --fg: #0f172a;
      --muted:#64748b;
      --card:#ffffff;
      --border:#e8ecf3;
      --accent:#2563eb;
      --radius:16px;
      --shadow: 0 10px 30px rgba(15,23,42,.06);
      --ring: 0 0 0 6px color-mix(in oklab, var(--accent) 14%, transparent);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0b1020;
        --fg:#e5e7eb;
        --muted:#9aa2b2;
        --card:#0f172a;
        --border:#1d253f;
        --shadow: 0 10px 32px rgba(0,0,0,.45);
        --accent:#3b82f6;
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font: 16px/1.6 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans";
      color:var(--fg); background:var(--bg);
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
      /* 低对比背景纹理 */
      background-image:
        radial-gradient(transparent 0 12px, color-mix(in oklab, var(--fg) 2%, transparent) 12px 13px),
        linear-gradient(0deg, color-mix(in oklab, var(--fg) 1%, transparent), color-mix(in oklab, var(--fg) 1%, transparent));
      background-size: 36px 36px, 100% 100%;
      background-position: -10px -10px, 0 0;
    }

    .wrap{max-width: 1180px; margin: 0 auto; padding: clamp(18px,4vw,28px);}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .logo{font-weight:900; font-size: clamp(22px,3.6vw,32px); letter-spacing:1px}
    nav{display:flex;gap:18px; color:var(--muted)}
    nav a{color:inherit; text-decoration:none; padding:6px 8px; border-radius:10px}
    nav a:hover{background:color-mix(in oklab, var(--fg) 6%, transparent)}

    /* 顶部搜索条 */
    .searchBar{display:flex;align-items:center; gap:14px; margin: 6px 0 18px}
    .search{position:relative;flex:1}
    .search input{width:100%; padding:14px 16px 14px 48px; border:1px solid var(--border); border-radius:14px; background:var(--card); box-shadow:var(--shadow)}
    .search input:focus{outline:none; box-shadow:var(--ring)}
    .search .icon{ position:absolute; left:16px; top:50%; translate:0 -50%; opacity:.7 }
    .btn{ border:1px solid var(--border); background:var(--card); border-radius:12px; padding:12px 14px; cursor:pointer; box-shadow:var(--shadow); transition:transform .06s ease, border-color .18s ease }
    .btn:hover{ border-color:var(--accent) }
    .btn:active{ transform:translateY(1px) }

    /* 主体两栏布局 */
    .layout{ display:grid; grid-template-columns: 1fr 280px; gap:18px }
    @media (max-width: 980px){ .layout{ grid-template-columns: 1fr } .aside{ order:-1 } }

    /* 卡片网格 */
    .grid{ display:grid; gap:14px; grid-template-columns: repeat(1, minmax(0,1fr)); }
    @media (min-width: 600px){ .grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (min-width: 900px){ .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); } }

    .card{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow) }

    .tagCard{ display:grid; place-items:center; min-height:120px; font-weight:900; font-size:28px; letter-spacing:1px; }

    .link{ display:flex; gap:12px; align-items:flex-start; padding:14px; text-decoration:none; color:inherit; border:1px solid var(--border); border-radius:14px; background:var(--card); box-shadow:var(--shadow); transition: transform .06s ease, border-color .18s ease; min-height:94px }
    .link:hover{ transform: translateY(-1px); border-color: var(--accent) }
    .ico{ flex:0 0 36px; width:36px; height:36px; border-radius:10px; border:1px solid var(--border); display:grid; place-items:center; background:var(--bg); font-weight:800 }
    .meta{ display:flex; flex-direction:column; gap:6px; min-width:0 }
    .title{ font-weight:750; font-size:15px; white-space:nowrap; text-overflow:ellipsis; overflow:hidden }
    .desc{ font-size:12px; color:var(--muted); white-space:nowrap; text-overflow:ellipsis; overflow:hidden }

    /* 侧边栏卡片 */
    .aside .card{ padding:14px }
    .aside h3{ margin:0 0 8px 0; font-size:14px; color:var(--muted); text-transform:uppercase; letter-spacing:.4px }
    .catList{ display:grid; gap:8px }
    .catItem{ padding:10px 12px; border:1px solid var(--border); border-radius:12px; background:var(--card); cursor:pointer; }
    .catItem.active{ border-color:var(--accent); box-shadow: var(--ring) }
    .recList{ display:grid; gap:10px }

    /* 对话框/编辑器 */
    dialog{ border:1px solid var(--border); border-radius:18px; max-width:min(880px,92vw); box-shadow:var(--shadow); padding:0; background:var(--card); color:var(--fg) }
    .dlg-head{ display:flex; justify-content:space-between; align-items:center; padding:12px 14px; border-bottom:1px solid var(--border) }
    .dlg-body{ padding:12px 14px }
    textarea{ width:100%; min-height:300px; border:1px solid var(--border); border-radius:12px; background:var(--bg); color:var(--fg); padding:12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:13px }
    .row{ display:flex; gap:10px; justify-content:flex-end; padding:0 14px 14px }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">XXOO</div>
      <nav aria-label="主导航">
        <a href="#">首页</a>
        <a href="#">关于</a>
      </nav>
    </header>

    <div class="searchBar">
      <div class="search" style="flex:1">
        <span class="icon">🔎</span>
        <input id="q" type="search" placeholder="Search… ( / )" autocomplete="off" />
      </div>
      <button class="btn" id="editBtn" title="编辑本地 JSON (Ctrl+E)">✏️ 编辑</button>
      <button class="btn" id="importBtn" title="导入 JSON">⬆️ 导入</button>
      <button class="btn" id="exportBtn" title="导出 JSON">⬇️ 导出</button>
    </div>

    <section class="layout">
      <main>
        <div class="grid" id="grid"></div>
      </main>
      <aside class="aside">
        <div class="card" style="margin-bottom:14px">
          <h3>分类</h3>
          <div id="catList" class="catList"></div>
        </div>
        <div class="card">
          <h3>网址推荐</h3>
          <div id="recList" class="recList"></div>
        </div>
      </aside>
    </section>
  </div>

  <!-- 编辑器对话框 -->
  <dialog id="editor">
    <div class="dlg-head">
      <strong>编辑链接（原始 JSON 结构）</strong>
      <button class="btn" id="closeDlg" aria-label="关闭">✖</button>
    </div>
    <div class="dlg-body">
      <textarea id="jsonArea" spellcheck="false"></textarea>
      <p style="margin:.6rem 0 0;color:var(--muted);font-size:12px">结构：<code>data → groupList → siteList</code>；字段：<code>name / url / desc</code>。保存后会持久化到 <code>localStorage</code>。</p>
    </div>
    <div class="row">
      <button class="btn" id="resetBtn">恢复初始</button>
      <button class="btn" id="saveBtn" style="background:var(--accent);color:#fff;border-color:var(--accent)">保存到本地</button>
    </div>
  </dialog>

  <input id="filePicker" type="file" accept="application/json" hidden>

  <script>
    /* ========= 初始数据（沿用你原始结构） ========= */
    let RAW = {
      "data":[{"id":1725801071594,"name":"网站","groupList":[
        {"id":1725801166515,"name":"分组 1","siteList":[
          {"id":1725801230597,"name":"Github","url":"https://github.com/wohccdaa/Curiosity-Curated-Navigation","favicon":"","desc":""},
          {"id":1754842556449,"name":"Telegram","url":"https://web.telegram.org/a/","favicon":"","desc":""}
        ]},
        {"id":1725801370995,"name":"分组 2 ","siteList":[
          {"id":1725801392782,"name":"Vercel","url":"https://vercel.com/wohccdaas-projects","favicon":"","desc":""},
          {"id":1725801420511,"name":"阿里域名","url":"https://dc.console.aliyun.com/next/index?spm=5176.12818093_47.overview_recent.2.3be92cc93m9IbE#/domain-list/all?type=","favicon":"","desc":""},
          {"id":1725801510569,"name":"Cloudflare","url":"https://dash.cloudflare.com/b5d549cb9c53a68240a04858b8669153/tlkk.top","favicon":"","desc":""}
        ]},
        {"id":1725801452515,"name":"分组 3","siteList":[
          {"id":1725801463245,"name":"IT 狗","url":"https://www.itdog.cn/http/","favicon":"","desc":""},
          {"id":1730015521044,"name":"W3C链接检查","url":"https://validator.w3.org/checklink","favicon":"","desc":""},
          {"id":1754842583129,"name":"风之谷 VPN","url":"https://cn1.fengzg.net/#/login","favicon":"","desc":""}
        ]},
        {"id":1725801619132,"name":"分组 4","siteList":[
          {"id":1726403456500,"name":"即刻","url":"https://web.okjike.com/","favicon":"","desc":""},
          {"id":1725801676787,"name":"有趣之家","url":"https://youquhome.com/message/","favicon":"","desc":""},
          {"id":1751297621049,"name":"科技爱好者周刊","url":"https://ruanyf.aolifu.org/","favicon":"","desc":""},
          {"id":1729604533332,"name":"偷懒周刊","url":"https://echosoar.github.io/weekly/","favicon":"","desc":""},
          {"id":1725801947812,"name":"Linuxdo","url":"https://linux.do/c/resource/14","favicon":"","desc":""},
          {"id":1729603630090,"name":"博客聚合","url":"https://www.v2ex.com/xna","favicon":"","desc":""},
          {"id":1729602527419,"name":"站长","url":"https://www.v2ex.com/go/webmaster","favicon":"","desc":""},
          {"id":1725801820129,"name":"分享创造","url":"https://www.v2ex.com/go/create","favicon":"","desc":"V2EX"},
          {"id":1726643045979,"name":"大橘周刊","url":"https://rrorangeandfriends.de/","favicon":"","desc":""},
          {"id":1725801723005,"name":"奇趣网站","url":"https://qiqu.dreamthere.cn/index/index","favicon":"","desc":""},
          {"id":1725801881657,"name":"小众软件","url":"https://meta.appinn.net/","favicon":"","desc":""}
        ]}
      ]}],
      "settings":{"linkStrategy":"newTab"}
    };

    /* ========= DOM ========= */
    const $ = s=>document.querySelector(s);
    const grid   = $("#grid");
    const qInput = $("#q");
    const catList= $("#catList");
    const recList= $("#recList");

    /* ========= 工具 ========= */
    function escapeHTML(s){return String(s??"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",
      ">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}
    const rand = (arr,n)=>arr.slice().sort(()=>Math.random()-.5).slice(0,n);
    function faviconURL(url){ try{ const u = new URL(url); return `${u.origin}/favicon.ico`; }catch{ return '' } }
    function initial(url){ try{ const u=new URL(url); const h=u.hostname.replace(/^www\./,''); return h[0]?.toUpperCase()||"·" }catch{ return "·" } }

    /* ========= 状态 ========= */
    let currentGroupIndex = 0; // 右侧分类切换

    function getGroups(){ const cats = RAW?.data?.[0]?.groupList || []; return cats; }

    function renderCats(){
      const groups = getGroups();
      catList.innerHTML = '';
      groups.forEach((g,i)=>{
        const item = document.createElement('div');
        item.className = 'catItem' + (i===currentGroupIndex?' active':'');
        item.textContent = g?.name || '未命名';
        item.addEventListener('click', ()=>{ currentGroupIndex = i; render(); });
        catList.appendChild(item);
      });
    }

    function renderRecs(){
      const groups = getGroups();
      const all = groups.flatMap(g=>g.siteList||[]);
      recList.innerHTML = '';
      rand(all, 3).forEach(s=>{
        const a = document.createElement('a');
        a.className = 'link'; a.href = s.url; a.target = '_blank'; a.rel = 'noopener';
        a.innerHTML = `<div class="ico"><img alt="" width="18" height="18" style="width:18px;height:18px" onerror="this.remove();this.parentElement.textContent='${escapeHTML(initial(s.url))}'" src="${escapeHTML(faviconURL(s.url))}"></div>
        <div class="meta"><div class="title">${escapeHTML(s.name||s.url)}</div><div class="desc">${escapeHTML(s.desc||'')}</div></div>`;
        recList.appendChild(a);
      })
    }

    function render(){
      const groups = getGroups();
      const g = groups[currentGroupIndex] || {name:'全部', siteList:[]};
      const kw = qInput.value.trim().toLowerCase();

      grid.innerHTML = '';
      // 左上角大标签卡片
      const tag = document.createElement('div');
      tag.className = 'card tagCard';
      tag.textContent = (g.name||'分组') + ' #';
      grid.appendChild(tag);

      (g.siteList||[]).filter(s=>{
        if(!kw) return true;
        return (s.name||'').toLowerCase().includes(kw)
          || (s.desc||'').toLowerCase().includes(kw)
          || (s.url||'').toLowerCase().includes(kw)
          || (g.name||'').toLowerCase().includes(kw);
      }).forEach(s=>{
        const a = document.createElement('a');
        a.className = 'link'; a.href = s.url; if(RAW?.settings?.linkStrategy!=="sameTab"){ a.target='_blank'; a.rel='noopener'; }
        a.innerHTML = `
          <div class="ico"><img alt="" width="18" height="18" style="width:18px;height:18px" onerror="this.remove();this.parentElement.textContent='${escapeHTML(initial(s.url))}'" src="${escapeHTML(faviconURL(s.url))}"></div>
          <div class="meta">
            <div class="title" title="${escapeHTML(s.name||s.url)}">${escapeHTML(s.name||s.url)}</div>
            ${s.desc?`<div class="desc" title="${escapeHTML(s.desc)}">${escapeHTML(s.desc)}</div>`:''}
          </div>`;
        grid.appendChild(a);
      });

      localStorage.setItem('nav.raw', JSON.stringify(RAW));
    }

    // 启动
    try{ const cached = JSON.parse(localStorage.getItem('nav.raw')); if (cached && cached.data) RAW = cached; }catch{}
    renderCats(); renderRecs(); render();

    // 搜索交互：/ 聚焦
    window.addEventListener('keydown', (e)=>{ if(e.key==='/' && document.activeElement!==qInput){ e.preventDefault(); qInput.focus(); }});
    qInput.addEventListener('input', render);

    // 编辑器
    const dlg = document.getElementById('editor');
    const jsonArea = document.getElementById('jsonArea');
    document.getElementById('editBtn').addEventListener('click', ()=>{ jsonArea.value = JSON.stringify(RAW,null,2); dlg.showModal(); jsonArea.focus(); });
    document.getElementById('closeDlg').addEventListener('click', ()=> dlg.close());
    document.getElementById('resetBtn').addEventListener('click', ()=>{ if(confirm('确认恢复到页面内置初始数据？这会覆盖本地自定义。')) location.reload(); });
    document.getElementById('saveBtn').addEventListener('click', saveFromTextarea);
    document.addEventListener('keydown', (e)=>{ if(dlg.open && e.key==='Escape') dlg.close(); if(dlg.open && e.ctrlKey && e.key.toLowerCase()==='s'){ e.preventDefault(); saveFromTextarea(); }});
    function saveFromTextarea(){ try{ const next=JSON.parse(jsonArea.value); if(!Array.isArray(next?.data)) throw new Error('缺少 data 数组'); RAW=next; renderCats(); renderRecs(); render(); dlg.close(); }catch(e){ alert('保存失败：
'+e.message); } }

    // 导入/导出
    const picker=document.getElementById('filePicker');
    document.getElementById('importBtn').addEventListener('click', ()=> picker.click());
    picker.addEventListener('change', async (e)=>{ const f=e.target.files?.[0]; if(!f) return; try{ const t=await f.text(); const next=JSON.parse(t); if(!Array.isArray(next?.data)) throw new Error('JSON 结构无效：需要 data 数组'); RAW=next; renderCats(); renderRecs(); render(); alert('已导入。'); }catch(err){ alert('导入失败：
'+err.message); } finally{ picker.value=''; } });
    document.getElementById('exportBtn').addEventListener('click', ()=>{ const blob=new Blob([JSON.stringify(RAW,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='nav.json'; a.click(); URL.revokeObjectURL(a.href); });
  </script>
</body>
</html>
