<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>奕奕宝宝的奶量大便辅食记录本</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root {
    --pink: #ff7fbf;
    --pink-light: #ffe8f3;
    --text-dark: #444;
}
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
    background: #fff0f7;
    margin: 0;
    padding: 15px;
}
.main-title {
    text-align: center;
    font-weight: bold;
    font-size: 24px;
    color: var(--pink);
    margin-bottom: 20px;
}
.section {
    background: white;
    padding: 20px;
    margin-bottom: 16px;
    border-radius: 16px;
    box-shadow: 0 3px 8px rgba(255,140,180,0.3);
}
h2 {
    margin: 0 0 12px;
    font-size: 20px;
    color: var(--pink);
    font-weight: bold;
}
input, select, button {
    width: 100%;
    padding: 16px;
    font-size: 18px;
    border-radius: 12px;
    margin: 8px 0;
    border: 2px solid #ffd1e8;
    background: #fffafd;
    box-sizing: border-box;
}
button {
    background: var(--pink);
    color: white;
    border: none;
    font-size: 20px;
    font-weight: bold;
}
button:active { opacity: .8; }
.item {
    padding: 10px 0;
    border-bottom: 1px solid #ffd8eb;
    font-size: 16px;
    color: var(--text-dark);
}
.stats {
    font-size: 16px;
    margin-top: 10px;
    line-height: 1.6;
}
.bold { font-weight: bold; }
.undo-btn {
    background: #ffb6d1;
    margin-top: 4px;
}
label { font-size: 16px; margin-top: 8px; display:block; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #ffd1e8; padding: 6px; text-align: center; }
</style>
</head>
<body>

<h1 class="main-title">奕奕宝宝的奶量大便辅食记录本</h1>

<!-- 奶量 -->
<div class="section">
<h2>喝奶记录</h2>
<select id="milkMix">
  <option value="30">30 ML / 1 勺</option>
  <option value="60">60 ML / 2 勺</option>
  <option value="90">90 ML / 3 勺</option>
  <option value="120">120 ML / 4 勺</option>
  <option value="150">150 ML / 5 勺</option>
  <option value="180">180 ML / 6 勺</option>
  <option value="210">210 ML / 7 勺</option>
  <option value="240">240 ML / 8 勺</option>
  <option value="270">270 ML / 9 勺</option>
  <option value="300">300 ML / 10 勺</option>
</select>
<input id="milkLeft" type="number" inputmode="numeric" placeholder="剩余奶量（ml，可选，默认0）">
<button id="milkBtn">记录奶量</button>
<button id="milkUndo" class="undo-btn">撤回奶量</button>

<div class="stats">
今日喝奶：<span id="milkToday">0</span> ml<br>
今日浪费：<span id="wasteToday">0</span> ml<br>
累计喝奶：<span id="milkTotal">0</span> ml<br>
累计浪费：<span id="wasteTotal">0</span> ml<br>
上次间隔：<span id="milkGap">无</span>
</div>
<div id="milkList"></div>
</div>

<!-- 大便 -->
<div class="section">
<h2>大便记录</h2>
<select id="pooStatus">
  <option value="">请选择状态</option>
  <option value="正常">正常</option>
  <option value="稀">稀</option>
  <option value="干">干</option>
  <option value="其他">其他</option>
</select>
<input id="pooNote" placeholder="备注（可空）">
<button id="pooBtn">记录大便</button>
<button id="pooUndo" class="undo-btn">撤回大便</button>

<div class="stats">
今日次数：<span id="pooToday">0</span>
</div>
<div id="pooList"></div>
</div>

<!-- 辅食 -->
<div class="section">
<h2>辅食记录</h2>
<input id="foodInput" placeholder="辅食内容（如 南瓜泥）">
<button id="foodBtn">记录辅食</button>
<button id="foodUndo" class="undo-btn">撤回辅食</button>

<div class="stats">
今日辅食次数：<span id="foodToday">0</span>
</div>
<div id="foodList"></div>
</div>

<!-- 底部总计统计模块 -->
<div class="section">
<h2>统计数据（总计）</h2>
<label>开始日期：<input type="date" id="statStart"></label>
<label>结束日期：<input type="date" id="statEnd"></label>
<button id="statBtn">查看总计统计</button>

<div class="stats" id="statResult">
<!-- 总计统计显示 -->
</div>
</div>

<!-- 按天统计表格模块 -->
<div class="section">
<h2>按天统计表格</h2>
<label>开始日期：<input type="date" id="statStartDay"></label>
<label>结束日期：<input type="date" id="statEndDay"></label>
<button id="statDayBtn">查看按天统计</button>

<div class="stats" id="statDayResult"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

    let milk = JSON.parse(localStorage.getItem("milk") || "[]");
    let poo  = JSON.parse(localStorage.getItem("poo") || "[]");
    let food = JSON.parse(localStorage.getItem("food") || "[]");

    function save() {
        localStorage.setItem("milk", JSON.stringify(milk));
        localStorage.setItem("poo", JSON.stringify(poo));
        localStorage.setItem("food", JSON.stringify(food));
    }
    function now() { return new Date().toISOString().slice(0,16).replace("T"," "); }

    // 奶量记录
    function addMilk() {
        const mixEl = document.getElementById("milkMix");
        const leftEl = document.getElementById("milkLeft");
        const inputMix = parseInt(mixEl.value);
        const left = parseInt(leftEl.value) || 0;
        if (!inputMix && inputMix!==0) { alert("请选择冲调奶量"); return; }
        if (left<0 || left>inputMix+10) { alert("剩余奶量不合理"); return; }

        const actualMix = inputMix + 10;
        const drink = actualMix - left;
        const waste = left;

        milk.push({mix: actualMix, left, drink, waste, time: now()});
        save(); updateMilk();
        leftEl.value="";
    }

    function updateMilk() {
        const milkList = document.getElementById("milkList");
        milkList.innerHTML = milk.map(i =>
            `<div class="item">${i.time}<br>冲调 <b>${i.mix}</b> ml · 喝掉 <b>${i.drink}</b> ml · 浪费 <b>${i.waste}</b> ml</div>`
        ).join("");
        const today = new Date().toISOString().slice(0,10);
        document.getElementById("milkToday").textContent = milk.filter(i=>i.time.startsWith(today)).reduce((a,b)=>a+b.drink,0);
        document.getElementById("wasteToday").textContent = milk.filter(i=>i.time.startsWith(today)).reduce((a,b)=>a+b.waste,0);
        document.getElementById("milkTotal").textContent = milk.reduce((a,b)=>a+b.drink,0);
        document.getElementById("wasteTotal").textContent = milk.reduce((a,b)=>a+b.waste,0);
        const gapEl = document.getElementById("milkGap");
        if (milk.length<2){ gapEl.textContent="无"; return; }
        const t1 = new Date(milk[milk.length-1].time);
        const t2 = new Date(milk[milk.length-2].time);
        gapEl.textContent = Math.floor((t1-t2)/60000) + " 分钟";
    }

    // 大便记录
    function addPoo() {
        const statusEl = document.getElementById("pooStatus");
        const noteEl = document.getElementById("pooNote");
        const status = statusEl.value;
        const note = noteEl.value.trim();
        if (!status){ alert("请先选择大便状态"); return; }
        poo.push({status, note, time: now()});
        save(); updatePoo();
        noteEl.value="";
    }
    function updatePoo() {
        const pooList = document.getElementById("pooList");
        pooList.innerHTML = poo.map(i =>
            `<div class="item">${i.time} - <b>${i.status}</b> ${i.note||""}</div>`
        ).join("");
        const today = new Date().toISOString().slice(0,10);
        document.getElementById("pooToday").textContent = poo.filter(i=>i.time.startsWith(today)).length;
    }

    // 辅食记录
    function addFood() {
        const foodEl = document.getElementById("foodInput");
        const t = foodEl.value.trim();
        if (!t){ alert("请输入辅食内容"); return; }
        food.push({text:t, time: now()});
        save(); updateFood();
        foodEl.value="";
    }
    function updateFood() {
        const foodList = document.getElementById("foodList");
        foodList.innerHTML = food.map(i =>
            `<div class="item">${i.time} - <b>${i.text}</b></div>`
        ).join("");
        const today = new Date().toISOString().slice(0,10);
        document.getElementById("foodToday").textContent = food.filter(i=>i.time.startsWith(today)).length;
    }

    // 撤回功能
    document.getElementById("milkUndo").addEventListener("click", function() {
        if(milk.length>0){ milk.pop(); save(); updateMilk(); }
    });
    document.getElementById("pooUndo").addEventListener("click", function() {
        if(poo.length>0){ poo.pop(); save(); updatePoo(); }
    });
    document.getElementById("foodUndo").addEventListener("click", function() {
        if(food.length>0){ food.pop(); save(); updateFood(); }
    });

    // 按钮绑定
    document.getElementById("milkBtn").addEventListener("click", addMilk);
    document.getElementById("pooBtn").addEventListener("click", addPoo);
    document.getElementById("foodBtn").addEventListener("click", addFood);

    // 总计统计
    document.getElementById("statBtn").addEventListener("click", function() {
        const start = document.getElementById("statStart").value;
        const end = document.getElementById("statEnd").value;
        if (!start || !end) { alert("请选择开始和结束日期"); return; }

        const milkRange = milk.filter(i => i.time.slice(0,10) >= start && i.time.slice(0,10) <= end);
        const milkDrinkSum = milkRange.reduce((a,b)=>a+b.drink,0);
        const milkWasteSum = milkRange.reduce((a,b)=>a+b.waste,0);
        const pooRange = poo.filter(i => i.time.slice(0,10) >= start && i.time.slice(0,10) <= end);
        const foodRange = food.filter(i => i.time.slice(0,10) >= start && i.time.slice(0,10) <= end);

        const statResult = document.getElementById("statResult");
        statResult.innerHTML = `
            <b>奶量喝掉总计：</b>${milkDrinkSum} ml<br>
            <b>奶量浪费总计：</b>${milkWasteSum} ml<br>
            <b>大便次数：</b>${pooRange.length}<br>
            <b>辅食次数：</b>${foodRange.length}
        `;
    });

    // 按天统计表格
    document.getElementById("statDayBtn").addEventListener("click", function() {
        const start = document.getElementById("statStartDay").value;
        const end = document.getElementById("statEndDay").value;
        if (!start || !end) { alert("请选择开始和结束日期"); return; }

        const startDate = new Date(start);
        const endDate = new Date(end);
        let html = `<table>
                    <tr>
                    <th>日期</th><th>奶量喝掉(ml)</th><th>奶量浪费(ml)</th><th>大便次数</th><th>辅食次数</th>
                    </tr>`;

        for(let d = new Date(startDate); d <= endDate; d.setDate(d.getDate()+1)) {
            const dayStr = d.toISOString().slice(0,10);
            const milkDay = milk.filter(i=>i.time.startsWith(dayStr));
            const milkDrinkSum = milkDay.reduce((a,b)=>a+b.drink,0);
            const milkWasteSum = milkDay.reduce((a,b)=>a+b.waste,0);
            const pooDay = poo.filter(i=>i.time.startsWith(dayStr));
            const foodDay = food.filter(i=>i.time.startsWith(dayStr));
            html += `<tr>
                    <td>${dayStr}</td>
                    <td>${milkDrinkSum}</td>
                    <td>${milkWasteSum}</td>
                    <td>${pooDay.length}</td>
                    <td>${foodDay.length}</td>
                    </tr>`;
        }
        html += `</table>`;
        document.getElementById("statDayResult").innerHTML = html;
    });

    // 初始加载
    updateMilk();
    updatePoo();
    updateFood();

});
</script>
</body>
</html>
