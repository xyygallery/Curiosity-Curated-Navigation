<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>奕奕宝宝的奶量大便辅食记录本</title>

<style>
:root {
    --pink: #ff8fb1;
    --bg: #fff5f8;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial;
    background: var(--bg);
    margin: 0;
    padding: 16px;
}

h1 {
    text-align: center;
    font-weight: bold;
    font-size: 24px;
    color: var(--pink);
    margin: 10px 0 20px 0;
}

.section {
    background: white;
    padding: 18px;
    margin-bottom: 20px;
    border-radius: 14px;
    box-shadow: 0 2px 8px #ffd9e6;
}

.section h2 {
    color: var(--pink);
    margin-top: 0;
    text-align: center;
}

input, select, button {
    width: 100%;
    padding: 18px;
    font-size: 20px;
    border-radius: 16px;
    margin: 8px 0;
    border: 2px solid #ffb6d1;
    background: #fffafd;
}

button {
    background: var(--pink);
    color: white;
    font-size: 22px;
}

.stats {
    text-align: center;
    font-size: 16px;
    color: #555;
    margin-top: 14px;
    line-height: 1.9;
}

.stats-block {
    padding: 6px 0;
    margin: 6px 0;
    border-bottom: 1px dashed #ffb6d1;
}

.stats-block:last-child {
    border-bottom: none;
}

table {
    width: 100%;
    margin-top: 14px;
    border-collapse: collapse;
    font-size: 14px;
}
th, td {
    border: 1px solid #ffb6d1;
    padding: 6px;
    text-align: center;
}

</style>
</head>
<body>

<h1>奕奕宝宝的奶量大便辅食记录本</h1>

<!-- 奶量记录 -->
<div class="section">
<h2>奶量记录</h2>

<select id="milkPrepare">
    <option value="">选择冲调奶量</option>
    <option value="30">30 ml / 1勺</option>
    <option value="60">60 ml / 2勺</option>
    <option value="90">90 ml / 3勺</option>
    <option value="120">120 ml / 4勺</option>
    <option value="150">150 ml / 5勺</option>
    <option value="180">180 ml / 6勺</option>
    <option value="210">210 ml / 7勺</option>
    <option value="240">240 ml / 8勺</option>
    <option value="270">270 ml / 9勺</option>
    <option value="300">300 ml / 10勺</option>
</select>

<input type="number" id="milkLeft" value="0" inputmode="numeric" placeholder="剩余奶量（默认0）">

<button id="milkBtn">记录奶量</button>

<button id="undoMilk">撤回上一次奶量记录</button>

<div class="stats">
    <div class="stats-block">今日喝奶：<span id="milkToday">0</span> ml</div>
    <div class="stats-block">今日浪费：<span id="wasteToday">0</span> ml</div>
    <div class="stats-block">累计喝奶：<span id="milkTotal">0</span> ml</div>
    <div class="stats-block">累计浪费：<span id="wasteTotal">0</span> ml</div>
    <div class="stats-block">上次间隔：<span id="milkGap">无</span></div>
</div>
</div>

<!-- 大便记录 -->
<div class="section">
<h2>大便记录</h2>

<select id="pooState">
    <option value="">选择大便状态</option>
    <option value="正常">正常</option>
    <option value="稀软">稀软</option>
    <option value="拉稀">拉稀</option>
    <option value="干硬">干硬</option>
</select>

<button id="pooBtn">记录大便</button>
<button id="undoPoo">撤回上一次大便记录</button>

<div class="stats">
    <div class="stats-block">今日次数：<span id="pooToday">0</span></div>
</div>
</div>

<!-- 辅食记录 -->
<div class="section">
<h2>辅食记录</h2>

<input type="text" id="foodText" placeholder="辅食内容">
<button id="foodBtn">记录辅食</button>
<button id="undoFood">撤回上一次辅食记录</button>

<div class="stats">
    <div class="stats-block">今日辅食次数：<span id="foodToday">0</span></div>
</div>
</div>

<!-- 按天统计 -->
<div class="section">
<h2>按天统计</h2>

<label>开始日期：<input type="date" id="statStart"></label>
<label>结束日期：<input type="date" id="statEnd"></label>
<button id="statBtn">查看统计</button>

<div id="statResult"></div>
</div>


<script>
// ---------------- 数据读取 ----------------
let milk = JSON.parse(localStorage.getItem("milk") || "[]");
let poo = JSON.parse(localStorage.getItem("poo") || "[]");
let food = JSON.parse(localStorage.getItem("food") || "[]");

// 保存函数
function saveAll() {
    localStorage.setItem("milk", JSON.stringify(milk));
    localStorage.setItem("poo", JSON.stringify(poo));
    localStorage.setItem("food", JSON.stringify(food));
}

// ---------------- 奶量记录 ----------------
document.getElementById("milkBtn").addEventListener("click", () => {
    const prepare = Number(document.getElementById("milkPrepare").value);
    const left = Number(document.getElementById("milkLeft").value);

    if (!prepare) { alert("请选择冲调奶量"); return; }
    if (left < 0) { alert("剩余奶量错误"); return; }

    const drink = prepare + 10 - left;
    const waste = left;

    milk.push({
        prepare,
        drink,
        waste,
        time: new Date().toISOString()
    });

    saveAll();
    updateStats();
});

// 奶量撤回
document.getElementById("undoMilk").addEventListener("click", () => {
    milk.pop();
    saveAll();
    updateStats();
});

// ---------------- 大便记录 ----------------
document.getElementById("pooBtn").addEventListener("click", () => {
    const state = document.getElementById("pooState").value;
    if (!state) { alert("请选择大便状态"); return; }

    poo.push({ state, time: new Date().toISOString() });
    saveAll();
    updateStats();
});

document.getElementById("undoPoo").addEventListener("click", () => {
    poo.pop();
    saveAll();
    updateStats();
});

// ---------------- 辅食记录 ----------------
document.getElementById("foodBtn").addEventListener("click", () => {
    const text = document.getElementById("foodText").value.trim();
    if (!text) { alert("请输入辅食内容"); return; }

    food.push({ text, time: new Date().toISOString() });
    saveAll();
    updateStats();
});

document.getElementById("undoFood").addEventListener("click", () => {
    food.pop();
    saveAll();
    updateStats();
});

// ---------------- 今日统计 ----------------
function updateStats() {
    const today = new Date().toISOString().slice(0, 10);

    const milkToday = milk.filter(i => i.time.startsWith(today));
    const pooToday = poo.filter(i => i.time.startsWith(today));
    const foodToday = food.filter(i => i.time.startsWith(today));

    document.getElementById("milkToday").textContent = milkToday.reduce((a,b)=>a+b.drink,0);
    document.getElementById("wasteToday").textContent = milkToday.reduce((a,b)=>a+b.waste,0);

    document.getElementById("milkTotal").textContent = milk.reduce((a,b)=>a+b.drink,0);
    document.getElementById("wasteTotal").textContent = milk.reduce((a,b)=>a+b.waste,0);

    document.getElementById("pooToday").textContent = pooToday.length;
    document.getElementById("foodToday").textContent = foodToday.length;

    // 上次间隔
    if (milk.length < 2) {
        document.getElementById("milkGap").textContent = "无";
    } else {
        let gap = new Date(milk[milk.length-1].time) - new Date(milk[milk.length-2].time);
        gap = Math.floor(gap / 60000);
        document.getElementById("milkGap").textContent = gap + " 分钟";
    }
}

updateStats();

// ---------------- 按天统计 ----------------
document.getElementById("statBtn").addEventListener("click", () => {
    const s = document.getElementById("statStart").value;
    const e = document.getElementById("statEnd").value;
    if (!s || !e) { alert("请选择日期范围"); return; }

    const start = new Date(s);
    const end = new Date(e);
    let html = `<table><tr><th>日期</th><th>喝奶</th><th>浪费</th><th>大便</th><th>辅食</th></tr>`;

    for (let d = new Date(start); d <= end; d.setDate(d.getDate()+1)) {
        const day = d.toISOString().slice(0,10);
        const m = milk.filter(i => i.time.startsWith(day));
        const p = poo.filter(i => i.time.startsWith(day));
        const f = food.filter(i => i.time.startsWith(day));

        html += `<tr>
            <td>${day}</td>
            <td>${m.reduce((a,b)=>a+b.drink,0)}</td>
            <td>${m.reduce((a,b)=>a+b.waste,0)}</td>
            <td>${p.length}</td>
            <td>${f.length}</td>
        </tr>`;
    }

    html += "</table>";
    document.getElementById("statResult").innerHTML = html;
});
</script>

</body>
</html>
