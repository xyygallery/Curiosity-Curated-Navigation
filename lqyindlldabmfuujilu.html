<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>å¥•å¥•å®å®çš„å¥¶é‡å¤§ä¾¿è¾…é£Ÿè®°å½•æœ¬</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
    background: #ffe6ef;
    margin: 0;
    padding: 15px;
    line-height: 1.6;
}

h1 {
    text-align: center;
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 20px;
    color: #d63384;
}

.card {
    background: #fff0f5;
    padding: 20px;
    margin-bottom: 15px;
    border-radius: 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}

.module-title {
    font-size: 20px;
    font-weight: 700;
    color: #d63384;
    margin-bottom: 12px;
    border-bottom: 2px solid #ff9ac8;
    padding-bottom: 6px;
    cursor: pointer;
}

label {
    font-weight: 600;
    color: #d63384;
    margin-bottom: 6px;
    display: block;
    text-align: left;
}

select, input[type="number"], input[type="text"], input[type="date"] {
    width: 100%;
    padding: 12px;
    margin-top: 5px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 16px;
    box-sizing: border-box;
}

button {
    width: 100%;
    padding: 14px;
    background: #ff4f9a;
    border: none;
    color: #fff;
    font-size: 17px;
    border-radius: 10px;
    margin-top: 8px;
    cursor: pointer;
    font-weight: 600;
    box-sizing: border-box;
}
button:active { background: #e63e89; }

button.undo {
    width: auto;
    padding: 6px 10px;
    font-size: 14px;
    background: #999;
    color: #fff;
    border-radius: 6px;
    margin-top: 6px;
}

.stats-block {
    text-align: center;
    margin-top: 10px;
}
.stats-block div {
    margin: 6px 0;
    font-size: 16px;
}

.range-select {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.toast {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.7);
    color: #fff;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 14px;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 1000;
}
.toast.show { opacity: 1; }

.collapsible-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease;
}
.collapsible-content.open {
    max-height: 600px; /* é€‚å½“å¤§äºå†…å®¹é«˜åº¦å³å¯ */
}
</style>
</head>

<body>

<h1>å¥•å¥•å®å®çš„å¥¶é‡å¤§ä¾¿è¾…é£Ÿè®°å½•æœ¬</h1>

<!-- å¥¶é‡è®°å½• -->
<div class="card">
    <div class="module-title">ğŸ¼ å¥¶é‡</div>
    <label>å†²å¥¶é‡</label>
    <select id="prep">
        <option value="">è¯·é€‰æ‹©å†²å¥¶é‡</option>
        <option value="30">30ml / 1å‹º</option>
        <option value="60">60ml / 2å‹º</option>
        <option value="90">90ml / 3å‹º</option>
        <option value="120">120ml / 4å‹º</option>
        <option value="150">150ml / 5å‹º</option>
        <option value="180">180ml / 6å‹º</option>
        <option value="210">210ml / 7å‹º</option>
        <option value="240">240ml / 8å‹º</option>
        <option value="270">270ml / 9å‹º</option>
        <option value="300">300ml / 10å‹º</option>
    </select>

    <label>å‰©ä½™å¥¶é‡ï¼ˆé»˜è®¤ 0ï¼‰</label>
    <input type="number" id="left" inputmode="numeric" value="0"/>

    <button onclick="recordMilk()">è®°å½•</button>
    <button onclick="undo('milk')" class="undo">æ’¤å›ä¸Šä¸€æ¬¡è®°å½•</button>
</div>

<!-- ä»Šæ—¥ç»Ÿè®¡ -->
<div class="card">
    <h2 style="text-align:center;color:#d63384;margin-top:0;">ä»Šæ—¥ç»Ÿè®¡</h2>
    <div class="stats-block" id="todayStats"></div>
</div>

<!-- å¤§ä¾¿è®°å½•ï¼ˆæŠ˜å ï¼‰ -->
<div class="card">
    <div class="module-title" onclick="toggleCollapse('pooContent')">ğŸ’© å¤§ä¾¿</div>
    <div id="pooContent" class="collapsible-content">
        <label>å¤§ä¾¿çŠ¶æ€</label>
        <select id="pooType">
            <option value="">è¯·é€‰æ‹©</option>
            <option value="æ­£å¸¸">æ­£å¸¸</option>
            <option value="ç¨€">ç¨€</option>
            <option value="å¹²">å¹²</option>
            <option value="ç²˜">ç²˜</option>
        </select>

        <button onclick="recordPoo()">è®°å½•</button>
        <button onclick="undo('poo')" class="undo">æ’¤å›ä¸Šä¸€æ¬¡è®°å½•</button>
    </div>
</div>

<!-- è¾…é£Ÿè®°å½•ï¼ˆæŠ˜å ï¼‰ -->
<div class="card">
    <div class="module-title" onclick="toggleCollapse('foodContent')">ğŸœ è¾…é£Ÿ</div>
    <div id="foodContent" class="collapsible-content">
        <label>è¾…é£Ÿ</label>
        <input type="text" id="food" placeholder="å¦‚ï¼šå—ç“œæ³¥ / ç²¥ / é¢æ¡" />

        <button onclick="recordFood()">è®°å½•</button>
        <button onclick="undo('food')" class="undo">æ’¤å›ä¸Šä¸€æ¬¡è®°å½•</button>
    </div>
</div>

<!-- æ—¶é—´èŒƒå›´ç»Ÿè®¡ï¼ˆæŠ˜å ï¼‰ -->
<div class="card">
    <div class="module-title" onclick="toggleCollapse('rangeContent')">ğŸ“Š æ•°æ®ç»Ÿè®¡</div>
    <div id="rangeContent" class="collapsible-content">
        <div class="range-select">
            <input type="date" id="startDate">
            <input type="date" id="endDate">
            <button onclick="calcRange()">æŸ¥çœ‹ç»Ÿè®¡</button>
        </div>
        <div id="rangeStats" class="stats-block"></div>
    </div>
</div>

<div id="toast" class="toast"></div>

<script>
/* ---- æ•°æ®åˆå§‹åŒ– ---- */
const load = k => JSON.parse(localStorage.getItem(k)||"[]");
let milk = load("milk");
let poo = load("poo");
let food = load("food");

/* ---- ä¿å­˜ ---- */
function save() {
    localStorage.setItem("milk", JSON.stringify(milk));
    localStorage.setItem("poo", JSON.stringify(poo));
    localStorage.setItem("food", JSON.stringify(food));
}

/* ---- å°æç¤º ---- */
function showToast(msg) {
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"),2000);
}

/* ---- æŠ˜å åŠŸèƒ½ (äº’æ–¥) ---- */
function toggleCollapse(id){
    const all = document.querySelectorAll('.collapsible-content');
    all.forEach(c=>{
        if(c.id!==id) c.classList.remove('open');
    });
    document.getElementById(id).classList.toggle('open');
}

/* ---- è®°å½•å¥¶é‡ ---- */
function recordMilk() {
    const prepSelect = document.getElementById("prep");
    if(!prepSelect.value) return showToast("è¯·å…ˆé€‰æ‹©å†²å¥¶é‡ï¼");
    const prep = Number(prepSelect.value);
    const left = Number(document.getElementById("left").value||0);
    const actualPrep = prep + 10;
    const drank = Math.max(actualPrep-left,0);
    const waste = Math.max(left,0);

    milk.push({time:Date.now(),prep:actualPrep,drank,waste});
    save();
    updateToday();
    document.getElementById("left").value = 0;
    prepSelect.value = "";
    showToast("å¥¶é‡è®°å½•æˆåŠŸï¼");
}

/* ---- è®°å½•å¤§ä¾¿ ---- */
function recordPoo() {
    const type = document.getElementById("pooType").value;
    if(!type) return showToast("è¯·å…ˆé€‰æ‹©å¤§ä¾¿çŠ¶æ€ï¼");
    poo.push({time:Date.now(),type});
    save();
    updateToday();
    document.getElementById("pooType").value="";
    showToast("å¤§ä¾¿è®°å½•æˆåŠŸï¼");
}

/* ---- è®°å½•è¾…é£Ÿ ---- */
function recordFood() {
    const content = document.getElementById("food").value.trim();
    if(!content) return showToast("è¯·è¾“å…¥è¾…é£Ÿå†…å®¹");
    food.push({time:Date.now(),content});
    save();
    updateToday();
    document.getElementById("food").value="";
    showToast("è¾…é£Ÿè®°å½•æˆåŠŸï¼");
}

/* ---- æ’¤å› ---- */
function undo(type) {
    if(type==="milk") {
        if(!milk.length) return showToast("æ²¡æœ‰å¥¶é‡è®°å½•å¯æ’¤å›");
        if(!confirm("ç¡®è®¤æ’¤å›æœ€åä¸€æ¬¡å¥¶é‡è®°å½•å—ï¼Ÿ")) return;
        milk.pop();
        showToast("å¥¶é‡è®°å½•å·²æ’¤å›");
    }
    if(type==="poo") {
        if(!poo.length) return showToast("æ²¡æœ‰å¤§ä¾¿è®°å½•å¯æ’¤å›");
        poo.pop();
        showToast("å¤§ä¾¿è®°å½•å·²æ’¤å›");
    }
    if(type==="food") {
        if(!food.length) return showToast("æ²¡æœ‰è¾…é£Ÿè®°å½•å¯æ’¤å›");
        food.pop();
        showToast("è¾…é£Ÿè®°å½•å·²æ’¤å›");
    }
    save();
    updateToday();
}

/* ---- ä»Šæ—¥ç»Ÿè®¡ ---- */
function updateToday() {
    const start = new Date(); start.setHours(0,0,0,0);
    const ts = start.getTime();

    const m = milk.filter(i=>i.time>=ts);
    const p = poo.filter(i=>i.time>=ts);
    const f = food.filter(i=>i.time>=ts);

    const drank = m.reduce((a,b)=>a+b.drank,0);
    const waste = m.reduce((a,b)=>a+b.waste,0);
    const last = m.length ? Math.floor((Date.now()-m[m.length-1].time)/60000) : null;

    document.getElementById("todayStats").innerHTML=
        <div>ä»Šæ—¥å–å¥¶ï¼š<b>${drank}</b> ML</div>
        <div>ä»Šæ—¥æµªè´¹ï¼š<b>${waste}</b> ML</div>
        <div>ä»Šæ—¥å¤§ä¾¿ï¼š<b>${p.length}</b> æ¬¡</div>
        <div>ä»Šæ—¥è¾…é£Ÿï¼š<b>${f.length}</b> æ¬¡</div>
        <div>ä¸Šæ¬¡å–å¥¶æ—¶é—´ï¼š<b>${last ? last+" åˆ†é’Ÿ":"æ— "}</b></div>
        <hr style="margin:15px 0;">
        <div>ç´¯è®¡å–å¥¶ï¼š<b>${milk.reduce((a,b)=>a+b.drank,0)}</b> ml</div>
        <div>ç´¯è®¡æµªè´¹ï¼š<b>${milk.reduce((a,b)=>a+b.waste,0)}</b> ml</div>
    ;
}
updateToday();

/* ---- æ—¶é—´èŒƒå›´ç»Ÿè®¡ ---- */
function calcRange() {
    const s=document.getElementById("startDate").value;
    const e=document.getElementById("endDate").value;
    if(!s||!e) return showToast("è¯·é€‰æ‹©å®Œæ•´çš„æ—¶é—´èŒƒå›´");
    const st=new Date(s).getTime();
    const et=new Date(e).getTime()+86400000-1;

    const m = milk.filter(i=>i.time>=st && i.time<=et);
    const p = poo.filter(i=>i.time>=st && i.time<=et);
    const f = food.filter(i=>i.time>=st && i.time<=et);

    document.getElementById("rangeStats").innerHTML=
        <div>æœŸé—´å–å¥¶ï¼š<b>${m.reduce((a,b)=>a+b.drank,0)}</b> ML</div>
        <div>æœŸé—´æµªè´¹ï¼š<b>${m.reduce((a,b)=>a+b.waste,0)}</b> ML</div>
        <div>æœŸé—´å¤§ä¾¿ï¼š<b>${p.length}</b> æ¬¡</div>
        <div>æœŸé—´è¾…é£Ÿï¼š<b>${f.length}</b> æ¬¡</div>
    ;
}
</script>
</body>
</html>
