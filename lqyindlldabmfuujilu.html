<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>奕奕宝宝的奶量大便辅食记录本</title>

<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
        background: #ffe6ef;
        margin: 0;
        padding: 15px;
        line-height: 1.6;
    }

    h1 {
        text-align: center;
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 20px;
        color: #d63384;
    }

    .card {
        background: #fff;
        padding: 15px;
        margin-bottom: 18px;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    label {
        font-weight: 600;
        color: #d63384;
        margin-bottom: 6px;
        display: block;
        text-align: left;
    }

    select, input[type="number"], input[type="text"], input[type="date"] {
        width: 100%;
        padding: 12px;
        margin-top: 5px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 16px;
        box-sizing: border-box;
    }

    button {
        width: 100%;
        padding: 14px;
        background: #ff4f9a;
        border: none;
        color: #fff;
        font-size: 17px;
        border-radius: 10px;
        margin-top: 8px;
        cursor: pointer;
        font-weight: 600;
        box-sizing: border-box;
    }
    button:active {
        background: #e63e89;
    }

    /* 撤回按钮样式 */
    button.undo {
        width: auto;
        padding: 6px 10px;
        font-size: 14px;
        background: #999;
        color: #fff;
        border-radius: 6px;
        margin-top: 6px;
    }

    .stats-block {
        text-align: center;
        margin-top: 10px;
    }
    .stats-block div {
        margin: 6px 0;
        font-size: 16px;
    }

    .range-select {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    /* 小提示文字 */
    .toast {
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.7);
        color: #fff;
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 14px;
        opacity: 0;
        transition: opacity 0.3s;
        z-index: 1000;
    }
    .toast.show {
        opacity: 1;
    }
</style>
</head>

<body>

<h1>奕奕宝宝的奶量大便辅食记录本</h1>

<!-- 奶量记录 -->
<div class="card">
    <label>冲调奶量</label>
    <select id="prep">
        <option value="30">30ml / 1勺</option>
        <option value="60">60ml / 2勺</option>
        <option value="90">90ml / 3勺</option>
        <option value="120">120ml / 4勺</option>
        <option value="150">150ml / 5勺</option>
        <option value="180">180ml / 6勺</option>
        <option value="210">210ml / 7勺</option>
        <option value="240">240ml / 8勺</option>
        <option value="270">270ml / 9勺</option>
        <option value="300">300ml / 10勺</option>
    </select>

    <label>剩余奶量（默认0）</label>
    <input type="number" id="left" inputmode="numeric" value="0"/>

    <button onclick="recordMilk()">记录奶量</button>
    <button onclick="undo('milk')" class="undo">撤回上一次奶量记录</button>
</div>

<!-- 大便记录 -->
<div class="card">
    <label>大便状态</label>
    <select id="pooType">
        <option value="">请选择</option>
        <option value="正常">正常</option>
        <option value="稀">稀</option>
        <option value="干">干</option>
        <option value="粘">粘</option>
    </select>

    <button onclick="recordPoo()">记录大便</button>
    <button onclick="undo('poo')" class="undo">撤回上一次大便记录</button>
</div>

<!-- 辅食记录 -->
<div class="card">
    <label>辅食内容</label>
    <input type="text" id="food" placeholder="如：南瓜泥 / 粥 / 面条" />

    <button onclick="recordFood()">记录辅食</button>
    <button onclick="undo('food')" class="undo">撤回上一次辅食记录</button>
</div>

<!-- 统计 -->
<div class="card">
    <h2 style="text-align:center;color:#d63384;margin-top:0;">今日统计</h2>
    <div class="stats-block" id="todayStats"></div>

    <h2 style="text-align:center;color:#d63384;margin-top:20px;">选择日期范围统计</h2>

    <div class="range-select">
        <input type="date" id="startDate">
        <input type="date" id="endDate">
        <button onclick="calcRange()">查看统计</button>
    </div>

    <div id="rangeStats" class="stats-block"></div>
</div>

<!-- 小提示容器 -->
<div id="toast" class="toast"></div>

<script>
/* ---- 数据初始化 ---- */
const load = k => JSON.parse(localStorage.getItem(k)||"[]");
let milk = load("milk");
let poo = load("poo");
let food = load("food");

function save() {
    localStorage.setItem("milk", JSON.stringify(milk));
    localStorage.setItem("poo", JSON.stringify(poo));
    localStorage.setItem("food", JSON.stringify(food));
}

/* ---- 小提示 ---- */
function showToast(msg) {
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"),2000);
}

/* ---- 记录奶量 ---- */
function recordMilk() {
    const prep = Number(document.getElementById("prep").value);
    const left = Number(document.getElementById("left").value||0);
    const actualPrep = prep + 10;
    const drank = Math.max(actualPrep-left,0);
    const waste = Math.max(left,0);

    milk.push({time:Date.now(),prep:actualPrep,drank,waste});
    save();
    updateToday();
    document.getElementById("left").value = 0;
    showToast("奶量记录成功！");
}

/* ---- 记录大便 ---- */
function recordPoo() {
    const type = document.getElementById("pooType").value;
    if(!type) return showToast("请先选择大便状态！");
    poo.push({time:Date.now(),type});
    save();
    updateToday();
    document.getElementById("pooType").value="";
    showToast("大便记录成功！");
}

/* ---- 记录辅食 ---- */
function recordFood() {
    const content = document.getElementById("food").value.trim();
    if(!content) return showToast("请输入辅食内容");
    food.push({time:Date.now(),content});
    save();
    updateToday();
    document.getElementById("food").value="";
    showToast("辅食记录成功！");
}

/* ---- 撤回 ---- */
function undo(type) {
    if(type==="milk") {
        if(!milk.length) return showToast("没有奶量记录可撤回");
        if(!confirm("确认撤回最后一次奶量记录吗？")) return;
        milk.pop();
        showToast("奶量记录已撤回");
    }
    if(type==="poo") {
        if(!poo.length) return showToast("没有大便记录可撤回");
        poo.pop();
        showToast("大便记录已撤回");
    }
    if(type==="food") {
        if(!food.length) return showToast("没有辅食记录可撤回");
        food.pop();
        showToast("辅食记录已撤回");
    }
    save();
    updateToday();
}

/* ---- 今日统计 ---- */
function updateToday() {
    const start = new Date(); start.setHours(0,0,0,0);
    const ts = start.getTime();

    const m = milk.filter(i=>i.time>=ts);
    const p = poo.filter(i=>i.time>=ts);
    const f = food.filter(i=>i.time>=ts);

    const drank = m.reduce((a,b)=>a+b.drank,0);
    const waste = m.reduce((a,b)=>a+b.waste,0);
    const last = m.length ? Math.floor((Date.now()-m[m.length-1].time)/60000) : null;

    document.getElementById("todayStats").innerHTML=`
        <div>今日喝奶：<b>${drank}</b> ml</div>
        <div>今日浪费：<b>${waste}</b> ml</div>
        <div>今日大便：<b>${p.length}</b> 次</div>
        <div>今日辅食：<b>${f.length}</b> 次</div>
        <div>上次喝奶间隔：<b>${last ? last+" 分钟":"无"}</b></div>
        <hr style="margin:15px 0;">
        <div>累计喝奶：<b>${milk.reduce((a,b)=>a+b.drank,0)}</b> ml</div>
        <div>累计浪费：<b>${milk.reduce((a,b)=>a+b.waste,0)}</b> ml</div>
    `;
}
updateToday();

/* ---- 时间范围统计 ---- */
function calcRange() {
    const s=document.getElementById("startDate").value;
    const e=document.getElementById("endDate").value;
    if(!s||!e) return showToast("请选择完整的时间范围");
    const st=new Date(s).getTime();
    const et=new Date(e).getTime()+86400000-1;

    const m = milk.filter(i=>i.time>=st && i.time<=et);
    const p = poo.filter(i=>i.time>=st && i.time<=et);
    const f = food.filter(i=>i.time>=st && i.time<=et);

    document.getElementById("rangeStats").innerHTML=`
        <div>期间喝奶：<b>${m.reduce((a,b)=>a+b.drank,0)}</b> ml</div>
        <div>期间浪费：<b>${m.reduce((a,b)=>a+b.waste,0)}</b> ml</div>
        <div>期间大便：<b>${p.length}</b> 次</div>
        <div>期间辅食：<b>${f.length}</b> 次</div>
    `;
}
</script>
</body>
</html>
