<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¥•å¥•å®å®çš„å¥¶é‡å¤§ä¾¿è¾…é£Ÿè®°å½•æœ¬</title>

<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
        margin: 0;
        background: #ffe6ef;
        padding-bottom: 70px; /* ç•™ä½ç½®ç»™åº•éƒ¨å¯¼èˆªæ  */
    }

    h1 {
        text-align: center;
        font-size: 22px;
        font-weight: 700;
        color: #d63384;
        margin: 15px 0 20px;
    }

    .card {
        background: #fff;
        margin: 15px;
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    label {
        display: block;
        margin-bottom: 6px;
        color: #d63384;
        font-weight: 600;
    }

    input, select {
        width: 100%;
        box-sizing: border-box;
        padding: 12px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 16px;
    }

    button {
        width: 100%;
        padding: 14px;
        background: #ff4f9a;
        border: none;
        color: #fff;
        font-size: 17px;
        border-radius: 10px;
        cursor: pointer;
        margin-top: 8px;
        font-weight: 600;
    }
    button:active { background: #e63e89; }

    /* åº•éƒ¨å¯¼èˆªæ  */
    .nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 65px;
        display: flex;
        background: #ffffff;
        border-top: 1px solid #ddd;
    }

    .nav button {
        flex: 1;
        border-radius: 0;
        border: none;
        background: #fff;
        color: #d63384;
        font-size: 15px;
        padding: 8px 0;
    }

    .nav button.active {
        color: #ff4f9a;
        font-weight: bold;
        background: #ffe0f0;
    }

    /* éšè—æ¨¡å— */
    .page {
        display: none;
    }
    .page.active {
        display: block;
    }

    .stats-block { text-align: center; }
    .stats-block div { margin: 6px 0; }
</style>
</head>

<body>

<h1>å¥•å¥•å®å®çš„å¥¶é‡å¤§ä¾¿è¾…é£Ÿè®°å½•æœ¬</h1>

<!-- å¥¶é‡é¡µé¢ -->
<div id="page-milk" class="page active">
    <div class="card">
        <label>å†²è°ƒå¥¶é‡</label>
        <select id="prep">
            <option value="30">30ml / 1å‹º</option>
            <option value="60">60ml / 2å‹º</option>
            <option value="90">90ml / 3å‹º</option>
            <option value="120">120ml / 4å‹º</option>
            <option value="150">150ml / 5å‹º</option>
            <option value="180">180ml / 6å‹º</option>
            <option value="210">210ml / 7å‹º</option>
            <option value="240">240ml / 8å‹º</option>
            <option value="270">270ml / 9å‹º</option>
            <option value="300">300ml / 10å‹º</option>
        </select>

        <label>å‰©ä½™å¥¶é‡ï¼ˆé»˜è®¤0ï¼‰</label>
        <input id="left" type="number" inputmode="numeric" value="0">

        <button onclick="recordMilk()">è®°å½•å¥¶é‡</button>
        <button onclick="undo('milk')" style="background:#999;">æ’¤å›ä¸Šä¸€æ¬¡å¥¶é‡è®°å½•</button>
    </div>
</div>

<!-- å¤§ä¾¿é¡µé¢ -->
<div id="page-poo" class="page">
    <div class="card">
        <label>å¤§ä¾¿çŠ¶æ€</label>
        <select id="pooType">
            <option value="">è¯·é€‰æ‹©</option>
            <option value="æ­£å¸¸">æ­£å¸¸</option>
            <option value="ç¨€">ç¨€</option>
            <option value="å¹²">å¹²</option>
            <option value="ç²˜">ç²˜</option>
        </select>

        <button onclick="recordPoo()">è®°å½•å¤§ä¾¿</button>
        <button onclick="undo('poo')" style="background:#999;">æ’¤å›ä¸Šä¸€æ¬¡å¤§ä¾¿è®°å½•</button>
    </div>
</div>

<!-- è¾…é£Ÿé¡µé¢ -->
<div id="page-food" class="page">
    <div class="card">
        <label>è¾…é£Ÿå†…å®¹</label>
        <input id="food" type="text" placeholder="å¦‚ï¼šå—ç“œæ³¥ / ç²¥ / é¢æ¡">

        <button onclick="recordFood()">è®°å½•è¾…é£Ÿ</button>
        <button onclick="undo('food')" style="background:#999;">æ’¤å›ä¸Šä¸€æ¬¡è¾…é£Ÿè®°å½•</button>
    </div>
</div>

<!-- ç»Ÿè®¡é¡µé¢ -->
<div id="page-stats" class="page">
    <div class="card">
        <h2 style="text-align:center;color:#d63384;margin-top:0;">ä»Šæ—¥ç»Ÿè®¡</h2>
        <div id="todayStats" class="stats-block"></div>

        <h2 style="text-align:center;color:#d63384;margin-top:20px;">æ—¶é—´èŒƒå›´ç»Ÿè®¡</h2>
        <input type="date" id="startDate">
        <input type="date" id="endDate">
        <button onclick="calcRange()">æŸ¥çœ‹ç»Ÿè®¡</button>

        <div id="rangeStats" class="stats-block"></div>
    </div>
</div>

<!-- åº•éƒ¨å¯¼èˆªæ  -->
<div class="nav">
    <button id="tab-milk" class="active" onclick="switchTab('milk')">ğŸ¼ å¥¶é‡</button>
    <button id="tab-poo" onclick="switchTab('poo')">ğŸ’© å¤§ä¾¿</button>
    <button id="tab-food" onclick="switchTab('food')">ğŸœ è¾…é£Ÿ</button>
    <button id="tab-stats" onclick="switchTab('stats')">ğŸ“Š ç»Ÿè®¡</button>
</div>


<script>
/* ---- é¡µé¢åˆ‡æ¢ ---- */
function switchTab(name) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));

    document.getElementById("page-" + name).classList.add("active");
    document.getElementById("tab-" + name).classList.add("active");
}

/* ---- æ•°æ®åŠ è½½ ---- */
const load = (k) => JSON.parse(localStorage.getItem(k) || "[]");
let milk = load("milk");
let poo  = load("poo");
let food = load("food");

function save() {
    localStorage.setItem("milk", JSON.stringify(milk));
    localStorage.setItem("poo", JSON.stringify(poo));
    localStorage.setItem("food", JSON.stringify(food));
}

/* ---- å¥¶é‡è®°å½• ---- */
function recordMilk() {
    const prep = Number(document.getElementById("prep").value);
    const left = Number(document.getElementById("left").value || 0);

    const actualPrep = prep + 10;
    const drank = Math.max(actualPrep - left, 0);
    const waste = Math.max(left, 0);

    milk.push({ time: Date.now(), prep: actualPrep, drank, waste });
    save();
    updateToday();

    document.getElementById("left").value = 0;
    alert("å¥¶é‡è®°å½•æˆåŠŸï¼");
}

/* ---- å¤§ä¾¿è®°å½• ---- */
function recordPoo() {
    const type = document.getElementById("pooType").value;
    if (!type) return alert("è¯·å…ˆé€‰æ‹©å¤§ä¾¿çŠ¶æ€ï¼");

    poo.push({ time: Date.now(), type });
    save();
    updateToday();

    document.getElementById("pooType").value = "";
    alert("å¤§ä¾¿è®°å½•æˆåŠŸï¼");
}

/* ---- è¾…é£Ÿè®°å½• ---- */
function recordFood() {
    const content = document.getElementById("food").value.trim();
    if (!content) return alert("è¯·è¾“å…¥è¾…é£Ÿå†…å®¹");

    food.push({ time: Date.now(), content });
    save();
    updateToday();

    document.getElementById("food").value = "";
    alert("è¾…é£Ÿè®°å½•æˆåŠŸï¼");
}

/* ---- æ’¤å› ---- */
function undo(type) {
    if (type === "milk" && milk.length) milk.pop();
    if (type === "poo"  && poo.length) poo.pop();
    if (type === "food" && food.length) food.pop();
    save();
    updateToday();
}

/* ---- ä»Šæ—¥ç»Ÿè®¡ ---- */
function updateToday() {
    const start = new Date();
    start.setHours(0,0,0,0);
    const ts = start.getTime();

    const m = milk.filter(i => i.time >= ts);
    const p = poo.filter(i => i.time >= ts);
    const f = food.filter(i => i.time >= ts);

    const drank = m.reduce((a,b)=>a+b.drank,0);
    const waste = m.reduce((a,b)=>a+b.waste,0);
    const last  = m.length ? Math.floor((Date.now() - m[m.length-1].time)/60000) : null;

    document.getElementById("todayStats").innerHTML = `
        <div>ä»Šæ—¥å–å¥¶ï¼š<b>${drank}</b> ml</div>
        <div>ä»Šæ—¥æµªè´¹ï¼š<b>${waste}</b> ml</div>
        <div>ä»Šæ—¥å¤§ä¾¿ï¼š<b>${p.length}</b> æ¬¡</div>
        <div>ä»Šæ—¥è¾…é£Ÿï¼š<b>${f.length}</b> æ¬¡</div>
        <div>ä¸Šæ¬¡å–å¥¶é—´éš”ï¼š<b>${last ? last+' åˆ†é’Ÿ' : 'æ— '}</b></div>
        <hr style="margin:15px 0;">
        <div>ç´¯è®¡å–å¥¶ï¼š<b>${milk.reduce((a,b)=>a+b.drank,0)}</b> ml</div>
        <div>ç´¯è®¡æµªè´¹ï¼š<b>${milk.reduce((a,b)=>a+b.waste,0)}</b> ml</div>
    `;
}
updateToday();

/* ---- æ—¥æœŸèŒƒå›´ç»Ÿè®¡ ---- */
function calcRange() {
    const s = document.getElementById("startDate").value;
    const e = document.getElementById("endDate").value;

    if (!s || !e) return alert("è¯·é€‰æ‹©å®Œæ•´æ—¥æœŸèŒƒå›´ï¼");

    const st = new Date(s).getTime();
    const et = new Date(e).getTime() + 86399999;

    const m = milk.filter(i => i.time >= st && i.time <= et);
    const p = poo.filter(i => i.time >= st && i.time <= et);
    const f = food.filter(i => i.time >= st && i.time <= et);

    document.getElementById("rangeStats").innerHTML = `
        <div>æœŸé—´å–å¥¶ï¼š<b>${m.reduce((a,b)=>a+b.drank,0)}</b> ml</div>
        <div>æœŸé—´æµªè´¹ï¼š<b>${m.reduce((a,b)=>a+b.waste,0)}</b> ml</div>
        <div>æœŸé—´å¤§ä¾¿ï¼š<b>${p.length}</b> æ¬¡</div>
        <div>æœŸé—´è¾…é£Ÿï¼š<b>${f.length}</b> æ¬¡</div>
    `;
}
</script>

</body>
</html>
